<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Server-Side Template Injection" /><meta property="og:locale" content="en" /><meta name="description" content="Server-Side Template Injection(SSTI)" /><meta property="og:description" content="Server-Side Template Injection(SSTI)" /><link rel="canonical" href="https://cyberkhalid.github.io/posts/ssti/" /><meta property="og:url" content="https://cyberkhalid.github.io/posts/ssti/" /><meta property="og:site_name" content="cyberkhalid" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-01T05:49:33+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Server-Side Template Injection" /><meta name="twitter:site" content="@_cyberkhalid" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-01T05:49:33+08:00","datePublished":"2022-01-01T05:49:33+08:00","description":"Server-Side Template Injection(SSTI)","headline":"Server-Side Template Injection","mainEntityOfPage":{"@type":"WebPage","@id":"https://cyberkhalid.github.io/posts/ssti/"},"url":"https://cyberkhalid.github.io/posts/ssti/"}</script><title>Server-Side Template Injection | cyberkhalid</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="cyberkhalid"><meta name="application-name" content="cyberkhalid"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://raw.githubusercontent.com/cyberkhalid/cyberkhalid/main/cyberl.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">cyberkhalid</a></div><div class="site-subtitle font-italic">Offensive Security || Red Team || Pentester || • 0xCyb3rkh4l1d •</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/cyberkhalid" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/_cyberkhalid" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['root','cyberkhalid.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Server-Side Template Injection</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Server-Side Template Injection</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/0xcyb3rkh4l1d">cyberkhalid</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1640987373" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-01-01 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="400 words"> <em>2 min</em> read</span></div></div></div><div class="post-content"><h1 id="server-side-template-injectionssti">Server-Side Template Injection(SSTI)</h1><p>Server Side Template Injection vulnerabilities (SSTI) occur when user input is embedded in a template in an unsafe manner and results in remote code execution on the server</p><h1 id="detection">Detection</h1><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/ssti1.png" alt="ssti" data-proofer-ignore></p><p>The webapp takes a profile name from the url and then displays it on the page with a welcoming text. Let’s try changing the profile name to <code class="language-plaintext highlighter-rouge">exploit</code> and see what will happen.</p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/ssti2.png" alt="ssti" data-proofer-ignore></p><p>As you can see, we got a welcoming message with our profile name displayed.</p><p>Let’s fuzz the url to see if we can break something and get an error, or if we can determine some anomality. There are lot of characters that can be used such as <code class="language-plaintext highlighter-rouge">{ } ; , || ' @ / &gt; &lt; $</code>….</p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/ssti3.png" alt="ssti" data-proofer-ignore></p><p>By supplying <code class="language-plaintext highlighter-rouge">{</code> <code class="language-plaintext highlighter-rouge">{</code> <code class="language-plaintext highlighter-rouge">&lt;</code>, we got an internal server error message. We might be thinking of server-side template engine running in the backend as they are used for dynamic rendering and also they mostly use <code class="language-plaintext highlighter-rouge">{ }</code> characters in their syntax. Let’s test for server-side template injection.</p><p>We will supply this payload <code class="language-plaintext highlighter-rouge">{2*2}</code> , if we get <code class="language-plaintext highlighter-rouge">22</code> or <code class="language-plaintext highlighter-rouge">4</code> as the profile name, then it’s vulnerable to ssti, otherwise we will proceed with another payload as most server-side templating engine has different syntax.</p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/ssti4.png" alt="ssti" data-proofer-ignore></p><p>As you can see, this was unsuccessfull, Therefore We will proceed with another payload to see what will happen. We will supply <code class="language-plaintext highlighter-rouge">{ { 2*2 } }</code>.</p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/ssti5.png" alt="ssti" data-proofer-ignore></p><p>Well, We got <code class="language-plaintext highlighter-rouge">4</code> as the profile name, which means it’s vulnerable to ssti.</p><h1 id="identification">Identification</h1><p>Since there are lot of server-side templating engine, we need to identify the server-side template engine in use so we can exploit it. The fact that server-side template engines interpret input differently will allow us to distinguish one from another. We will use the below image to determine our engine.</p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/sstiengine.png" alt="engine" data-proofer-ignore></p><p>By using the above image, since we successfully executed <code class="language-plaintext highlighter-rouge">{ { 2*2 } }</code>, our engine will be either jinja2 or twig . Let’s supply <code class="language-plaintext highlighter-rouge">{ { 5*'3' } }</code> to see what will happen</p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/ssti7.png" alt="ssti" data-proofer-ignore></p><p>As you can see, we got <code class="language-plaintext highlighter-rouge">33333</code>. this means our engine is jinja2.</p><p>Let’s test for jinja2 by supplying <code class="language-plaintext highlighter-rouge">{ { config } }</code></p><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/ssti8.png" alt="ssti" data-proofer-ignore></p><p>Great!,Our payload was successfull, therefore, we have finally determine our engine which is jinja2.</p><h1 id="exploitation">Exploitation</h1><p>We can supply the below payload to execute shell command.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="o">{</span> <span class="o">{</span> <span class="s1">''</span>.__class__.__mro__[1].__subclasses__<span class="o">()[</span>401]<span class="o">(</span><span class="s2">"whoami"</span>, <span class="nv">shell</span><span class="o">=</span>True, <span class="nv">stdout</span><span class="o">=</span><span class="nt">-1</span><span class="o">)</span>.communicate<span class="o">()</span> <span class="o">}</span> <span class="o">}</span>

</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/ssti11.png" alt="ssti" data-proofer-ignore></p><p>We have executed shell command.</p><h1 id="references">References</h1><ul><li><a href="https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/07-Input_Validation_Testing/18-Testing_for_Server_Side_Template_Injection">https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/07-Input_Validation_Testing/18-Testing_for_Server_Side_Template_Injection</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/webapp-and-api-pentesting/'>WebApp And Api Pentesting</a>, <a href='/categories/server-side-template-injection/'>Server-Side Template Injection</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Server-Side Template Injection - cyberkhalid&amp;url=https://cyberkhalid.github.io/posts/ssti/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Server-Side Template Injection - cyberkhalid&amp;u=https://cyberkhalid.github.io/posts/ssti/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://cyberkhalid.github.io/posts/ssti/&amp;text=Server-Side Template Injection - cyberkhalid" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/pcron/">Cronjob</a><li><a href="/posts/autorun/">Registry Autoruns</a><li><a href="/posts/pwautorun/">Registry Autoruns</a><li><a href="/posts/pwstartup/">Startups</a><li><a href="/posts/winprivsrvunq/">Insecure Service-> Unquoted Service Path</a></ul></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/xpathi/"><div class="card-body"> <em class="timeago small" data-ts="1640987373" > 2022-01-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>XPATH Injection</h3><div class="text-muted small"><p> XPATH Injection XPath Injection attacks occur when a web site uses user-supplied information to construct an XPath query for XML data. By sending intentionally malformed information into the web s...</p></div></div></a></div><div class="card"> <a href="/posts/xssd/"><div class="card-body"> <em class="timeago small" data-ts="1640987373" > 2022-01-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DOM-based XSS</h3><div class="text-muted small"><p> DOM-based XSS Cross-Site Scripting (XSS) attacks are a type of injection, in which malicious scripts are injected into otherwise benign and trusted websites. XSS attacks occur when an attacker use...</p></div></div></a></div><div class="card"> <a href="/posts/xssr/"><div class="card-body"> <em class="timeago small" data-ts="1640987373" > 2022-01-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Reflected XSS</h3><div class="text-muted small"><p> Reflected XSS Cross-Site Scripting (XSS) attacks are a type of injection, in which malicious scripts are injected into otherwise benign and trusted websites. XSS attacks occur when an attacker use...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/lfi/" class="btn btn-outline-primary" prompt="Older"><p>Local File Inclusion</p></a> <a href="/posts/unvalidatedredirect/" class="btn btn-outline-primary" prompt="Newer"><p>Open Redirection</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/0xcyb3rkh4l1d">cyberkhalid</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
