---
title: AdminSDHolder
date: 2022-06-03 05:49:33 +0800
categories: [Infrastructure Pentesting, Active Directory]
tags: []  
---

# AdminSDHolder

AdminSDHolder is a container that exists in every Active Directory domain for a special purpose. The Access Control List (ACL) of the AdminSDHolder object is used as a template to copy permissions to all “protected groups” in Active Directory and their members. Protected groups include privileged groups such as Domain Admins, Administrators, Enterprise Admins, and Schema Admins. Active Directory will take the ACL of the AdminSDHolder object and apply it to all protected users and groups periodically, in an effort to make sure the access to these objects is secure.

If an attacker is able to manipulate the ACL for AdminSDHolder, then those permissions will automatically be applied to all protected objects.

Note: `This is a domain persistence technigue, therefore, assume we have compromised domain administrator's account and we are trying to achieve persistence in the domain.`

# Exploitation

Since we have compromised administrator account, we will manipulate acl of AdminSDHolder and give our user `usman` a `GenericAll` right on AdminSDHolder.

![ma](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/adminsdholder1.png)

```powershell

add-objectacl -TargetIdentity AdminSDHolder -PrincipalIdentity usman -verbose -Rights All

```

![ma](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/machineaccount2.png)

As you can see, usman has been given `GenericAll` right on AdminSDHolder. We will login to usman account and verify it.

![ma](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/machineaccount5.png)

Great!. user usman has `GenericAll` on AdminSDHolder.

Now after 60+ minutes, the changes will automatically be applied to all protected objects. But you force the changes to apply immediately via ldp.exe by Modifying DN like so.

![ma](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/machineaccount6.png)

Now , let's confirm that the user `usman` has `GenericAll` on the protected objects.

![ma](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/machineaccount8.png)

As you can see, user `usman` has `GenericAll` on all protected objects.

Since usman has GenericAll on `Domain Admins` group, he can abuse it to obtain system shell of domain controller.

![ma](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/machineaccount9.png)

# References

- [https://stealthbits.com/blog/20170619persistence-using-adminsdholder-and-sdprop/](https://stealthbits.com/blog/20170619persistence-using-adminsdholder-and-sdprop/)
