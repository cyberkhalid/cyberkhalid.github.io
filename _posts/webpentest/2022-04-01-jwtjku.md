---
title: JWT Authentication Bypass -> jku header injection
date: 2022-01-01 05:49:33 +0800
categories: [WebApp And Api Pentesting, JWT Authentication Bypass -> jku header injection]
tags: []  
---

# JWT Authentication Bypass -> jku header injection

JSON web tokens (JWTs) are a standardized format for sending cryptographically signed JSON data between systems. They can theoretically contain any kind of data, but are most commonly used to send information ("claims") about users as part of authentication, session handling, and access control mechanisms.  If the server is insecurely configured to accept unsigned jwts, attacker can modify jwt token to elevate his privileges. If the server supports the jku parameter in the JWT header but it fails to check whether the provided URL belongs to a trusted domain before fetching the key, then attacker can alter the jwt token to escalate his privileges.

# Exploitation

This webapp uses a JWT-based mechanism for handling sessions. The server supports the jku parameter in the JWT header. However, it fails to check whether the provided URL belongs to a trusted domain before fetching the key. We are going to modify our session token to gain access to the admin panel at /admin.

We will login with the following credentials `wiener:peter`.

![jwt](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/jwtu1.png)

![jwt](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/jwtu2.png)

We have logged in as `wiener`. We will refresh the page and intercept the request in burpsuite.

![jwt](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/jwtjku1.png)

We will generate new rsa key and host the public key in our own server.

![jwt](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/jwtjku2.png)

We will then modify the value of `jku` to contain our domain on which we hosted the public key, modify the value of `sub` to `administrator`.

![jwt](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/jwtjku3.png)

Then sign the token with our generated rsa key and forward the request.

![jwt](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/jwtjku4.png)

![jwt](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/jwtjku5.png)

![jwt](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/jwta7.png)

We have accessed admin interface.

# References

- [https://portswigger.net/web-security/jwt](https://portswigger.net/web-security/jwt)
