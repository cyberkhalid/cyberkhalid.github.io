---
title: Nosql Injection
date: 2022-01-01 05:49:33 +0800
categories: [WebApp And Api Pentesting, Nosql Injection]
tags: [webapp, pentesting, Owasp, nosql, injection]     # TAG names should always be lowercase
---

# Nosql Injection

# exploitation

## Authentication Bypass

![nosqli](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/nosql1.png)

This authentication uses nosql database `mongodb` to authenticate a user. If it's not configured securely, we can bypass the authentication and login to an account for which we don't have permission. 

Enter anything as username and password, intercept the request in burpsuite , and then forward the request.

![nosqli](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/nosql3.png)

Since the our credential was incorrect, we got an error from the response.

Let's try to bypass the authentication by supplying this payload `user[$ne]=1&pass[$ne]=1`. If this goes well, the backend will execute something like `['username' => ['$ne' => 1]], 'password' => ['$ne' => 1]]`, this means to look for username which is not equal to 1, and password which is not equal 1, which will be true, so we will be able to bypass the authentication.

![nosqli](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/nosql4.png)

As you can see we have been redirected. By following the redirection, we were able to login to admin account.

![nosqli](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/nosql5.png)

## Extracting Password

We can extract user's password using regex. To do that, we need to know the actual length of the password. In regex, `^.{1}$` means a string of 1 length, `^.{5}$` means a string of five length, and so on.. , therefore, if we can supply this payload `user=admin&pass[$regex]=^.{[length]}$`, we will be able to determine the length of the password.

We will start with number 1 and then increment it until we get the length. Our input will now be `user=admin&pass[$regex]=^.{1}$`.

![nosqli](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/nosql6.png)

We were redirected to error page, which means the password length is greater than 1. We will proceed by incrementing the number until we find the right one.

![nosqli](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/nosql7.png)

We have been redirected to profile page, which means `8` was the correct length.

Since we have the length of the password, we will proceed to extract the password itself. Our regex will be something like `^........$` with the number of dot `.` equals to the length of the password `8`. Since `.` matches anything , this means `^........$`  will match anything whose length is 8. If we replace the first dot with `k` which is `^k.......$`, it means to match a string that starts with `k` and whose length is 8. In this way, we can extract the password of the user by changing the character until we get the right one, we will be doing thesame thing to all dot `.`.

The easier way to do this is to forward our request to burp intruder and set our payload containing all the characters that can be used in a passwords.

![nosqli](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/nosql8.png)

![nosqli](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/nosql9.png)

As you can see we were able to get the first character of the password. We will be repeating thesame to all until we get the password.

![nosqli](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/nosql9.png)

We have finally got the password as `admin123`. We can now login as admin with `admin123` as the password.

![nosqli](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/nosql10.png)

![nosqli](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/nosql11.png)


