---
title: Code Injection
date: 2022-01-01 05:49:33 +0800
categories: [WebApp And Api Pentesting, Code Injection]
tags: [webapp, pentesting, Owasp, code, injection]     # TAG names should always be lowercase
---

# Code Injection

# Detection

![codei](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei2.png)

The webapp seems to take in user supplied input and reflect it on the page. if we replace test with any text we want, we will have our text displayed on the page. Let's replace it with `exploit`.

![codei](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei3.png)

We got `exploit` displayed on the page.

Let's conduct a fuzzing on the parameter to see if we can break something and get an error, or if we can determine some anomality. There are lot of characters that can be used such as `; , || ' @ / > < $...`. We will start with `;`.

We are going to supply `exploit;` and see if we can get something interesting

![codei](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei4.png)

Well, it reflected the text without `;`, it supposed to display `exploit;` not `exploit` on the page, so there must be something behind.

Let's change the input to be like this `;exploit` and see again 

![codei](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei5.png)

As you can see nothing was displayed, which was supposed to display `;exploit` on the page. This means our input broke something in the backend, this webapp may be vulnerable to either `code injection` or `command injection` because `;` character is mostly used in shell or in code that is needed to execute text as part of the code. 

Let's test for code injection. Since this is php, we will make use of `phpinfo()` function to test for code injection, which if successfull will display plenty information about php and the server itself. We will supply `exploit;phpinfo();`

![codei](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei6.png)

We got it. This means the webapp is vulnerable to code injection.

# Exploitation

## Echo'ying text

Let's see if we can execute php code by supplying this `exploit;echo 'yes';`

![codei](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei7.png)

It's been executed, you can see `yes` has been displayed on the page.

## System Command

php has `system` function that will allow us to execute shell command in the backend. Let's supply `exploit;system('id');` 

![codei](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei8.png)

Well, `id` was executed.

## Reverse Shell

To get a reverse shell, we will intercept the request in burp suite, setup our listerner, supply our payload and then forward it to the server.

our payload here

``` bash


```

![codei](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei9.png)


![codei](https://raw.githubusercontent.com/cyberkhalid/cyberkhalid.github.io/main/assets/img/ipentest/codei10.png)

We got reverse shell.

